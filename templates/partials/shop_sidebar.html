<style>
    .div1 {
        grid-column: 1 / 2;
        grid-row: 1 / 3;
        background: #fff;
        border-radius: 20px;
        padding: 30px 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
        box-shadow: 0 2px 8px #e1efd8;
        min-width: 0;
        position: relative;
    }
    .logout-btn {
        position: absolute;
        top: 20px;
        left: 20px;
        background: #eaf6e3;
        color: red;
        border: 1px solid #b7d7a8;
        border-radius: 8px;
        padding: 10px 22px;
        font-size: 18px;
        font-weight: 500;
        text-decoration: none;
        z-index: 10;
        box-shadow: 0 2px 8px #e1efd8;
        transition: filter 0.2s;
    }
    .logout-btn:hover {
        filter: brightness(0.95);
        background: #ffeaea;
    }

        /* Avatar and Seller Shop */
        .seller-avatar {
            width: 170px;
            height: 170px;
            background: #e2f0d9;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            position: relative;
            cursor: pointer;
        }
        .seller-avatar img {
            width: 130px;
            height: 130px;
            border-radius: 50%;
            object-fit: cover;
        }
        .upload-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(240, 173, 78, 0.8);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
            color: white;
            font-size: 12px;
            text-align: center;
            font-weight: 600;
        }
        .seller-avatar:hover .upload-overlay {
            opacity: 1;
        }
        .seller-avatar:hover {
            transform: scale(1.02);
            transition: transform 0.2s ease;
        }
        .profile-upload-form {
            display: none;
        }
        
        /* Modal Styles */
        .profile-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(2px);
        }
        
        .profile-modal-content {
            background-color: #fff;
            margin: 10% auto;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 30px rgba(240, 173, 78, 0.3);
            text-align: center;
            position: relative;
        }
        
        .modal-close {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 28px;
            font-weight: bold;
            color: #aaa;
            cursor: pointer;
            transition: color 0.3s;
        }
        
        .modal-close:hover {
            color: #333;
        }
        
        .modal-title {
            font-size: 24px;
            font-weight: bold;
            color: #333;
            margin-bottom: 20px;
        }
        
        .image-preview-container {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            margin: 20px auto;
            border: 4px solid #f0ad4e;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f5f5f5;
        }
        
        .image-preview {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }
        
        .preview-placeholder {
            color: #999;
            font-size: 16px;
            text-align: center;
        }
        
        .file-input-wrapper {
            margin: 20px 0;
        }
        
        .file-input-button {
            background: #f0ad4e;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: background 0.3s;
            margin-bottom: 10px;
        }
        
        .file-input-button:hover {
            background: #ec971f;
        }
        
        .modal-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 25px;
        }
        
        .modal-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s;
            min-width: 100px;
        }
        
        .modal-btn-save {
            background: #f0ad4e;
            color: white;
        }
        
        .modal-btn-save:hover {
            background: #ec971f;
            transform: translateY(-1px);
        }
        
        .modal-btn-save:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .modal-btn-cancel {
            background: #f44336;
            color: white;
        }
        
        .modal-btn-cancel:hover {
            background: #d32f2f;
            transform: translateY(-1px);
        }
        .seller-shop-title {
            margin-bottom: 5px;
            font-size: 1.5em;
            font-weight: bold;
            text-align: center;
            color: #222;
        }
        .seller-menu {
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 0;
            margin-top: 10px;
        }
        .seller-menu a {
            width: 100%;
            border: none;
            padding: 14px 0;
            font-size: 20px;
            font-weight: 400;
            text-align: center;
            text-decoration: none;
        }
        .active {
            background: #f0ad4e;
            color: #fff;
            font-size: 22px;
            font-weight: 500;
            margin-bottom: 2px;
            box-shadow: 2px 4px 8px #b7d7a8;
            letter-spacing: 0.5px;
        }
        .seller-menu a:not(.active) {
            background: #eaf6e3;
            color: #222;
            border: 1px solid #b7d7a8;
            border-radius: 0;
        }
        .seller-menu a:first-child {
            border-radius: 6px 6px 0 0;
        }
        .seller-menu a:last-child {
            border-radius: 0 0 6px 6px;
        }
        .notification-badge {
            position: absolute;
            top: 8px;
            right: 15px;
            background: #dc3545;
            color: white;
            font-size: 11px;
            font-weight: 700;
            padding: 3px 7px;
            border-radius: 10px;
            min-width: 18px;
            text-align: center;
        }
</style>

<div class="div1">
    <a href="{{ url_for('logout') }}" class="logout-btn">Logout</a>
    <div class="seller-avatar" onclick="openShopProfileModal();">
        {% if session.get('shop_profile_image') %}
            <img src="{{ session['shop_profile_image'] }}" alt="Shop Profile Picture" style="width:130px;height:130px;border-radius:50%;object-fit:cover;" />
        {% else %}
            <!-- Use project's default logo when shop has no profile image -->
            <img src="{{ url_for('static', filename='images/logo.png') }}" alt="Default Shop Logo" style="width:130px;height:130px;border-radius:50%;object-fit:cover;" />
        {% endif %}
        <div class="upload-overlay">
            <div>Click to<br>change photo</div>
        </div>
    </div>
    
    <!-- Shop Profile Picture Modal -->
    <div id="shopProfileModal" class="profile-modal">
        <div class="profile-modal-content">
            <span class="modal-close" onclick="closeShopProfileModal()">&times;</span>
            <h2 class="modal-title">Change Shop Profile Picture</h2>
            
            <div class="image-preview-container">
                <img id="shopImagePreview" class="image-preview" style="display: none;" />
                <div id="shopPreviewPlaceholder" class="preview-placeholder">No image selected</div>
            </div>
            
            <div class="file-input-wrapper">
                <button type="button" class="file-input-button" onclick="document.getElementById('shopModalFileInput').click();">
                    Choose Image
                </button>
                <input type="file" id="shopModalFileInput" accept="image/*" style="display: none;" onchange="previewShopImage(this);" />
                <div style="font-size: 12px; color: #666; margin-top: 5px;">
                    Supported formats: PNG, JPG, JPEG, GIF
                </div>
            </div>
            
            <div class="modal-buttons">
                <button type="button" class="modal-btn modal-btn-save" id="shopSaveBtn" onclick="saveShopProfileImage();" disabled>
                    Save Changes
                </button>
                <button type="button" class="modal-btn modal-btn-cancel" onclick="closeShopProfileModal();">
                    Cancel
                </button>
            </div>
        </div>
    </div>
    
    <!-- Hidden form for actual upload -->
    <form id="hiddenShopUploadForm" action="{{ url_for('upload_shop_profile_image') }}" method="post" enctype="multipart/form-data" style="display: none;">
        <input type="file" id="hiddenShopFileInput" name="profile_image" />
    </form>
    
    <h2 class="seller-shop-title">{{ session.get('shop_name') }}</h2>
    <div class="seller-menu">
        <a href="{{ url_for('seller_dashboard') }}" class="{% if request.path == url_for('seller_dashboard') %}active{% endif %}">Dashboard</a>
        <a href="{{ url_for('seller_products') }}" class="{% if request.path == url_for('seller_products') %}active{% endif %}">Products</a>
        <a href="{{ url_for('edit_shop') }}" class="{% if request.path == url_for('edit_shop') %}active{% endif %}">Edit Shop</a>
        <a href="{{ url_for('seller_messages') }}" class="{% if request.path == url_for('seller_messages') %}active{% endif %}">Messages</a>
        <a href="{{ url_for('seller_order_history') }}" class="{% if request.path == url_for('seller_order_history') %}active{% endif %}">Order History</a>
    <a href="{{ url_for('seller_account') }}" class="{% if request.path == url_for('seller_account') %}active{% endif %}">Seller's Account</a>
    </div>
</div>

<script>
let selectedShopFile = null;

function openShopProfileModal() {
    document.getElementById('shopProfileModal').style.display = 'block';
    resetShopModal();
}

function closeShopProfileModal() {
    document.getElementById('shopProfileModal').style.display = 'none';
    resetShopModal();
}

function resetShopModal() {
    selectedShopFile = null;
    document.getElementById('shopImagePreview').style.display = 'none';
    document.getElementById('shopPreviewPlaceholder').style.display = 'block';
    document.getElementById('shopSaveBtn').disabled = true;
    document.getElementById('shopModalFileInput').value = '';
}

function previewShopImage(input) {
    const file = input.files[0];
    if (file) {
        // Validate file type
        const allowedTypes = ['image/png', 'image/jpg', 'image/jpeg', 'image/gif'];
        if (!allowedTypes.includes(file.type)) {
            alert('Please select a valid image file (PNG, JPG, JPEG, or GIF).');
            input.value = '';
            return;
        }
        
        // Validate file size (max 5MB)
        if (file.size > 5 * 1024 * 1024) {
            alert('File size must be less than 5MB.');
            input.value = '';
            return;
        }
        
        selectedShopFile = file;
        const reader = new FileReader();
        reader.onload = function(e) {
            const preview = document.getElementById('shopImagePreview');
            const placeholder = document.getElementById('shopPreviewPlaceholder');
            
            preview.src = e.target.result;
            preview.style.display = 'block';
            placeholder.style.display = 'none';
            document.getElementById('shopSaveBtn').disabled = false;
        };
        reader.readAsDataURL(file);
    }
}

function saveShopProfileImage() {
    if (selectedShopFile) {
        const hiddenInput = document.getElementById('hiddenShopFileInput');
        const hiddenForm = document.getElementById('hiddenShopUploadForm');
        
        // Create a new FileList with the selected file
        const dt = new DataTransfer();
        dt.items.add(selectedShopFile);
        hiddenInput.files = dt.files;
        
        // Submit the form
        hiddenForm.submit();
    }
}

// Close modal when clicking outside of it
window.onclick = function(event) {
    const shopModal = document.getElementById('shopProfileModal');
    if (event.target === shopModal) {
        closeShopProfileModal();
    }
}
</script>